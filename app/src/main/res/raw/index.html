<!DOCTYPE html>
<html>
    <head>
        <title>State Display</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/moment@^2"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@^1"></script>
        <link
                href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
                rel="stylesheet"
                integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
                crossorigin="anonymous" />
    </head>
    <body style="background-color: black">
        <h1>Temperature Over the Last 100 Minutes</h1>
        <div style="width: 100%; height: 50%">
            <canvas id="chartCanvas"></canvas>
        </div>
        <script
                src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
                crossorigin="anonymous"></script>
        <script>
        async function fetchTemperatureData() {
          try {
            const response = await fetch("/data");
            if (!response.ok) {
              throw new Error("Failed to fetch data");
            }
            return await response.json();
          } catch (error) {
            console.error("Error fetching data:", error);
            return { time: [], values: [] };
          }
        }

        async function updateChart(chart) {
          const data = await fetchTemperatureData();

          // Update the chart with the fetched data
          chart.data.labels = data.time;
          chart.data.datasets[0].data = data.values;
          chart.update();
        }

        var ctx = document.getElementById("chartCanvas");

        var chart = new Chart(ctx, {
          type: "line",
          data: {
            labels: [],
            datasets: [
              {
                label: "Temperature (Â°C)",
                data: [],
                borderColor: "rgb(255, 99, 132)",
                fill: false,
              },
            ],
          },
          options: {
            width: "100%",
            height: "50%",
            legend: {
              position: "top",
              labels: {
                color: "blue",
              },
            },
            scales: {
              x: {
                grid: {
                  color: "rgba(255, 255, 255, 0.2)",
                },
                ticks: {
                  color: "white", // labels such as 10, 20, etc
                },
                type: "time",
                time: {
                  unit: "minutes",
                  displayFormats: {
                    minutes: "HH:mm", // 24-hour format
                  },
                },
                title: {
                  display: true,
                  text: "time [hh:mm]",
                  color: "white",
                },
              },
              y: {
                grid: {
                  color: "rgba(255, 255, 255, 0.2)",
                },
                ticks: {
                  color: "white", // labels such as 10, 20, etc
                },
                beginAtZero: true,
                title: {
                  display: true,
                  text: "volume [dBu]",
                  color: "white",
                },
              },
            },
          },
        });
        updateChart(chart);

        // Auto-refresh the chart every 60 seconds (or as needed)
        setInterval(function () {
          updateChart(chart);
        }, 1000 * 5); // every 5 sek




        </script>
    </body>
</html>
