<!DOCTYPE html>
<html>
    <head>
        <title>State Display</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/moment@^2"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@^1"></script>
        <style>
        /* Ensure the chart takes up the entire screen */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: black;
        }
        /* Center the canvas element */
        canvas {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
        }

        </style>
    </head>
    <body>
        <div>
            <canvas id="chartCanvas"></canvas>
        </div>
        <script>
        async function fetchTemperatureData() {
          try {
            const response = await fetch("/data");
            if (!response.ok) {
              throw new Error("Failed to fetch data");
            }
            return await response.json();
          } catch (error) {
            console.error("Error fetching data:", error);
            return { time: [], values: [] };
          }
        }

        async function updateChart(chart) {
          const data = await fetchTemperatureData();

          // Update the chart with the fetched data
          chart.data.labels = data.time;
          chart.data.datasets[0].data = data.values;
          chart.update();
        }

        var ctx = document.getElementById("chartCanvas");

        var chart = new Chart(ctx, {
          type: "line",
          data: {
            labels: [],
            datasets: [
              {
                label: "Temperature (Â°C)",
                data: [],
                borderColor: "rgb(255, 99, 132)",
                fill: false,
              },
            ],
          },
          options: {
            legend: {
              position: "top",
              labels: {
                color: "blue",
              },
            },
            scales: {
              x: {
                grid: {
                  color: "rgba(255, 255, 255, 0.2)",
                },
                ticks: {
                  color: "white", // labels such as 10, 20, etc
                },
                type: "time",
                time: {
                  unit: "minutes",
                  displayFormats: {
                    minutes: "HH:mm", // 24-hour format
                  },
                },
                title: {
                  display: true,
                  text: "time [hh:mm]",
                  color: "white",
                },
              },
              y: {
                grid: {
                  color: "rgba(255, 255, 255, 0.2)",
                },
                ticks: {
                  color: "white", // labels such as 10, 20, etc
                },
                beginAtZero: true,
                title: {
                  display: true,
                  text: "volume [dBu]",
                  color: "white",
                },
              },
            },
          },
        });
        updateChart(chart);

        // Auto-refresh the chart every 60 seconds (or as needed)
        setInterval(function () {
          updateChart(chart);
        }, 1000 * 5); // every 5 sek












        </script>
    </body>
</html>
